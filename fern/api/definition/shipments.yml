# yaml-language-server: $schema=https://raw.githubusercontent.com/fern-api/fern/main/fern.schema.json

imports:
  commons: commons.yml

service:
  auth: true
  base-path: /v1/shipments
  endpoints:
    create:
      path: ""
      docs: Gets shipping rates for a new shipment.
      method: POST
      request:
        name: CreateShipmentRequest
        body:
          properties:
            sender: commons.Sender
            recipient: commons.Recipient
            parcel: commons.Parcel
      response: ShipmentResponse
      examples:
        - request:
            sender: $commons.Sender.Example1
            recipient: $commons.Recipient.Example1
            parcel: $commons.Parcel.Example1
          response:
            body:
              status: 200
              data: $Shipment.Example1
              message: You created a shipment
              errors: []
              events: [shipment.rates_generated, shipment.tracking_updated]
              endpoint: /

    list:
      docs: Lists shipments up to the specified limit starting at the specified page
      path: ""
      method: GET
      response: ShipmentResponse

    retrieve:
      docs: Retrieves a specific shipment
      method: GET
      path: /{shipment}
      path-parameters:
        shipment: string
      response: ShipmentResponse

    purchase:
      docs: Purchases a shipping label
      method: POST
      path: /{shipment}
      path-parameters:
        shipment: string
      request:
        name: PurchaseShippingLabelRequest
        body:
          properties:
            rate_id:
              type: string
              docs: The ID of the rate that you wish to purchase
            payment_method:
              type: optional<string>
              docs: The ID of the payment method that you want to use from the payment methods you have on file with PackageX. If not provided, we'll use the default payment method on file
            payment_reference:
              type: string
              docs: A reference to the payment that can be added to this shipment. This is a field generated by the user
            label_size: LabelSize
      response: ShipmentResponse
      examples:
        - path-parameters:
            shipment: ship_czhgjrk5JaVvyATPDbyURp
          request:
            rate_id: "rate_bdc2f190408545ec8a118886fd5e1dee"
            payment_reference: "Sandbox Department"
            label_size: "4x6"
          response:
            body:
              status: 200
              data: $Shipment.Example1
              message: You purchased a shipping label
              errors: []
              events: [shipment.purchase, shipment.tracking_updated]
              endpoint: /ship_czhgjrk5JaVvyATPDbyURp

types:
  LabelSize:
    docs: Specify a label size for the returned shipping label. If not included, we'll use the default shipping label size set from the PackageX Dashboard.
    enum:
      - name: "FOUR_BY_SIX"
        value: "4x6"
      - name: "letter"
        value: "letter"
      - name: "FOUR_BY_EIGHT"
        value: "4x8"
      - name: "a4"
        value: "a4"
      - name: "a6"
        value: "a6"

  ShipmentResponse:
    extends: commons.Response
    properties:
      data: Shipment

  Rate:
    docs: The shipping rate object showing the service level, price, and shipping provider information
    properties:
      id:
        docs: The ID for this rate. To purchase a shipping label after getting rates, you will pass in this rate to indicate you wish to purchase it
        type: string
      amount:
        docs: The amount that will be collected from a customer. This includes any upcharges or discounts you have added to the price on the PackageX Dashboard.
        type: integer
      billed_amount:
        docs: The amount that your organization will be billed for this rate.
        type: integer
      carrier_account:
        docs: The custom rate card that was used for this transaction. Should be null for all organizations currently.
        type: optional<string>
      pickup_at:
        docs: Time in epoch seconds when this shipment will be picked up, if that is included in the service of this rate. Will be null otherwise.
        type: optional<integer>
      provider: commons.Provider
      service_level: ServiceLevel
    examples:
      - name: Example1
        value:
          id: dndine29dnc9
          amount: 1203
          billed_amount: 9023
          service_level: $ServiceLevel.Example1
          provider: $commons.Provider.Example1

  ServiceLevel:
    docs: The service level for this rate
    properties:
      name:
        docs: The human readable name for this service label
        type: string
      id:
        docs: The unique ID of this provider's service level
        type: string
      terms:
        docs: The human readable delivery estimate for this rate
        type: string
      days:
        docs: The integer of days that this delivery is estimated to take if the provider receives the shipment before their daily cutoff time.
        type: integer
      estimated_delivery:
        docs: The time in epoch seconds when we estimate the shipment at this rate will be delivered
        type: integer
      pickup_at:
        docs: The time in epoch seconds when this shipment will be picked up for this rate
        type: integer
    examples:
      - name: Example1
        value:
          id: 3bicjss933jckjcsww
          name: Same Day
          days: 1
          estimated_delivery: 1679591515
          terms: "Today by 9pm"
          pickup_at: 1679591623

  Attributes:
    docs: Indicates certain aspects of the item that will impact shipping and handling
    enum:
      - alcohol
      - marijuana
      - pharma
      - dry_ice
      - lithium

  RefundStatus:
    docs: The status of the refund on this shipment if one was requested
    enum:
      - requested
      - refunded
      - rejected

  RateTypes:
    docs: The type of rate that should be returned for the shipment.
    enum:
      - in_person_pickup
      - curbside_pickup
      - locker_pickup
      - provider_delivery
      - offline_delivery

  ShipmentOptions:
    docs: Options that were passed in when generated shipping rates.
    properties:
      provider_timeout:
        docs: The amount of time in milliseconds to wait for a shipping provider before discarding it's results.
        type: integer
      verify_address:
        docs: If all addresses for the shipment should be verified
        type: boolean
      checkout_total:
        docs: The total price in USD cents for the cart total during an e-commerce purchase.
        type: integer
      request_provider_pickup:
        docs: If the shipping provider should pick up this package.
        type: boolean
      providers:
        docs: The list of shipping provider IDs that you want returned.
        type: list<string>
      service_levels:
        docs: The list of service level IDs that you want returned.
        type: list<string>
      max_delivery_days:
        docs: The maximum number of delivery days for this shipment.
        type: integer
      rate_types: RateTypes

  Shipment:
    docs: A shipment object
    properties:
      amount:
        docs: The amount that will be collected from a customer. This includes any upcharges or discounts you have added to the price on the PackageX Dashboard.
        type: optional<integer>
      billed_amount:
        docs: The amount that your organization will be billed for this rate.
        type: optional<integer>
      provider:
        type: optional<commons.Provider>
      created_at:
        docs: Time in epoch seconds when this shipment was created.
        type: integer
      updated_at:
        docs: Time in epoch seconds when this shipment was last updated.
        type: integer
      currency: Currency
      estimated_delivery:
        docs: Time in epoch seconds when we estimate the delivery will occur.
        type: optional<integer>
      filters: list<commons.Filters>
      fulfillment_id:
        docs: The ID of the fulfillment that created this shipment.
        type: string
      id:
        docs: The unique ID for the shipment
        type: string
      refund_status: optional<RefundStatus>
      status: commons.ShipmentStatus
      lead_time_mins:
        docs: The amount of lead time needed to prepare the shipment for an on-demand courier. This is only applicable for same-day shipments and indicated how much advance notice is required between the shipping provider and sender before a courier will be dispatched.
        type: integer
      metadata:
        docs: Custom key value pairs that the organization is able to add to this shipment
        type: optional<map<string, unknown>>
      options: optional<ShipmentOptions>
      paid:
        docs: If the shipment has been paid for
        type: boolean
      parcels:
        docs: The individual packages that are part of this shipment.
        type: list<commons.Parcel>
      payment_reference:
        docs: A user generated reference for this payment. Will be included in invoices.
        type: optional<string>
      purchased_rate: optional<Rate>
      rates:
        docs: All of the rates that were returned when creating this shipment
        type: list<Rate>
      recipient: commons.Recipient
      sender: commons.Sender
      pickup_at:
        docs: Seconds from epoch when this shipment will be picked up, if pickup is part of the rate's service level
        type: optional<integer>
      organization_id:
        docs: The ID of the organization that owns this shipment
        type: string
      label_url:
        docs: The url for the shipping label
        type: optional<string>
      invoice_id:
        docs: The ID of the invoice for this shipment
        type: string
      kiosk_id:
        docs: This kiosk that was used to generate this shipment.
        type: string
      tracking_number:
        docs: The tracking number for this shipment.
        type: string
      tracking_url:
        docs: The url for the end user to track their shipment
        type: string
      feedback: optional<ShipmentFeedback>
      tracking_updates:
        docs: A list of all tracking updates that occurred for this shipment from oldest to newest
        type: list<commons.TrackingUpdate>
      coordinates: list<double>
      _search: optional<commons.Search>
    examples:
      - name: Example1
        value:
          amount: 1324
          billed_amount: 1023
          provider: $commons.Provider.Example1
          created_at: 1679245915
          updated_at: 1679245933
          currency: usd
          estimated_delivery: 1679591515
          filters: [completed]
          fulfillment_id: efewifb31221
          id: defbei39dkna
          status: out_for_delivery
          lead_time_mins: 13
          paid: true
          parcels: [$commons.Parcel.Example1]
          purchased_rate: $Rate.Example1
          rates: [$Rate.Example1]
          recipient: $commons.Recipient.Example1
          sender: $commons.Sender.Example1
          organization_id: dwndiwqe22en2
          invoice_id: verwdwdwq3j33x2
          kiosk_id: fcewueek9393
          tracking_number: wefewfwecn290ioieqoi1221239
          tracking_url: https://www.ups.com/track?loc=en_US&requester=ST/
          tracking_updates:
            [$commons.TrackingUpdate.Example1, $commons.TrackingUpdate.Example2]
          coordinates: [37.7749, 122.4194]

  ShipmentFeedback:
    docs: User provided feedback for this shipment
    properties:
      rating: optional<FeedbackRating>
      comment:
        docs: A comment that the user provided about their experience
        type: optional<string>
      updated_at:
        docs: When the feedback was updated in epoch seconds
        type: optional<integer>

  FeedbackRating:
    type: integer

  Currency:
    docs: The currency used for this shipment.
    enum:
      - usd

  Error:
    docs: An error response
    properties:
      status:
        docs: A 4XX or 5XX status code indicating the error that occurred
        type: integer
      message:
        docs: A human readable message to display to an end user
        type: string
      error_code:
        type: string
        docs: The developer code for the issue that occurred.
      data:
        type: optional<map<string, unknown>>
        docs: The data object will be empty on errors
      errors:
        docs: An list of errors that occurred. Normally will be of the properties that failed validation.
        type: list<string>
      pagination: commons.Pagination
      events:
        docs: All of the events that were triggered due to this request
        type: list<string>
      endpoint:
        docs: The endpoint that was hit
        type: string
