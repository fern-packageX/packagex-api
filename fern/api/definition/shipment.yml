# yaml-language-server: $schema=https://raw.githubusercontent.com/fern-api/fern/main/fern.schema.json

imports:
  commons: commons.yml
  address: address.yml
  fulfillment: inventory/fulfillment.yml

service:
  auth: true
  base-path: /v1/shipments
  display-name: Shipments
  endpoints:
    getRates:
      path: ""
      docs: | 
        There are three pieces of information we require to get rates: sender, 
        recipient, and parcel. There are also some additional options you can 
        pass in to configure the shipment.
      display-name: Get Shipment Rates
      method: POST
      request:
        name: GetShipmentRatesRequest
        body:
          properties:
            sender: commons.Sender
            recipient: commons.Recipient
            parcel: ParcelShipment
            options: optional<ShipmentOptions>
      response: ShipmentResponse
      examples:
        - request:
            sender: $commons.Sender.Example1
            recipient: $commons.Recipient.Example1
            parcel: $ParcelShipment.Example1
          response:
            body:
              status: 200
              data: $Shipment.Example1
              message: You created a shipment
              errors: []
              events: [shipment.rates_generated, shipment.tracking_updated]
              endpoint: /v1/shipments

    purchase:
      docs: Purchase Shipment Rate
      display-name: Purchase Shipment Rate
      method: POST
      path: /{shipmentId}
      path-parameters:
        shipmentId: ShipmentId
      request:
        name: PurchaseShipmentRateRequest
        body:
          properties:
            rate_id:
              type: string
              docs: The ID of the rate that you wish to purchase
            payment_method:
              type: optional<string>
              docs: The ID of the payment method that you want to use from the payment methods you have on file with PackageX. If not provided, we'll use the default payment method on file
            payment_reference:
              type: string
              docs: A reference to the payment that can be added to this shipment. This is a field generated by the user
            label_size: LabelSize
      response: ShipmentResponse
      examples:
        - path-parameters:
            shipmentId: ship_czhgjrk5JaVvyATPDbyURp
          request:
            rate_id: "rate_bdc2f190408545ec8a118886fd5e1dee"
            payment_reference: "Sandbox Department"
            label_size: "4x6"
          response:
            body:
              status: 200
              data: $Shipment.Example1
              message: You purchased a shipping label
              errors: []
              events: [shipment.purchase, shipment.tracking_updated]
              endpoint: /v1/shipments/ship_czhgjrk5JaVvyATPDbyURp
    
    refetchRates: 
      docs: | 
        After you already fetched rates, you can also fetch new rates. You'll want to do this if:
          - Your rate has expired because the rates_generated_at is more than 15 minutes from now.
          - You want to update your options that you added into the shipment.
      display-name: Refetch Shipment Rates
      method: POST
      path: /{shipmentId}/refetch
      path-parameters:
        shipmentId: ShipmentId
      request:
        name: RefetchShipmentRatesRequest
        body:
          properties:
            options: optional<ShipmentOptions>
      response: ShipmentResponse
    
    list:
      docs: Lists shipments up to the specified limit starting at the specified page
      display-name: List Shipments
      path: ""
      method: GET
      response: ListShipmentResponse

    retrieve:
      docs: Retrieves a specific shipment
      display-name: Retrieve Shipment
      method: GET
      path: /{shipmentId}
      path-parameters:
        shipmentId: ShipmentId
      response: ShipmentResponse

types:
  ShipmentId: string

  LabelSize:
    docs: Specify a label size for the returned shipping label. If not included, we'll use the default shipping label size set from the PackageX Dashboard.
    enum:
      - name: "FOUR_BY_SIX"
        value: "4x6"
      - letter
      - name: "FOUR_BY_EIGHT"
        value: "4x8"
      - a4
      - a6

  ShipmentResponse:
    extends: commons.Response
    properties:
      data: Shipment
  
  ListShipmentResponse:
    extends: commons.Response
    properties:
      data: list<Shipment>

  Rate:
    docs: The shipping rate object showing the service level, price, and shipping provider information
    properties:
      id:
        docs: The ID for this rate. To purchase a shipping label after getting rates, you will pass in this rate to indicate you wish to purchase it
        type: string
      amount:
        docs: The amount that will be collected from a customer. This includes any upcharges or discounts you have added to the price on the PackageX Dashboard.
        type: integer
      billed_amount:
        docs: The amount that your organization will be billed for this rate.
        type: integer
      carrier_account:
        docs: The custom rate card that was used for this transaction. Should be null for all organizations currently.
        type: optional<string>
      pickup_at:
        docs: Time in epoch seconds when this shipment will be picked up, if that is included in the service of this rate. Will be null otherwise.
        type: optional<integer>
      provider: commons.Provider
      service_level: ServiceLevel
    examples:
      - name: Example1
        value:
          id: dndine29dnc9
          amount: 1203
          billed_amount: 9023
          service_level: $ServiceLevel.Example1
          provider: $commons.Provider.Example1

  ServiceLevel:
    docs: The service level for this rate
    properties:
      name:
        docs: The human readable name for this service label
        type: string
      id:
        docs: The unique ID of this provider's service level
        type: string
      terms:
        docs: The human readable delivery estimate for this rate
        type: string
      days:
        docs: The integer of days that this delivery is estimated to take if the provider receives the shipment before their daily cutoff time.
        type: integer
      estimated_delivery:
        docs: The time in epoch seconds when we estimate the shipment at this rate will be delivered
        type: integer
      pickup_at:
        docs: The time in epoch seconds when this shipment will be picked up for this rate
        type: integer
    examples:
      - name: Example1
        value:
          id: 3bicjss933jckjcsww
          name: Same Day
          days: 1
          estimated_delivery: 1679591515
          terms: "Today by 9pm"
          pickup_at: 1679591623

  RefundStatus:
    docs: The status of the refund on this shipment if one was requested
    enum:
      - requested
      - refunded
      - rejected

  RateTypes:
    docs: The type of rate that should be returned for the shipment.
    enum:
      - in_person_pickup
      - curbside_pickup
      - locker_pickup
      - provider_delivery
      - offline_delivery

  ShipmentOptions:
    docs: Options that were passed in when generated shipping rates.
    properties:
      provider_timeout:
        docs: The amount of time in milliseconds to wait for a shipping provider before discarding it's results.
        type: optional<integer>
      verify_address:
        docs: If all addresses for the shipment should be verified
        type: optional<boolean>
      checkout_total:
        docs: The total price in USD cents for the cart total during an e-commerce purchase.
        type: optional<integer>
      request_provider_pickup:
        docs: If the shipping provider should pick up this package.
        type: optional<boolean>
      providers:
        docs: The list of shipping provider IDs that you want returned.
        type: optional<list<string>>
      service_levels:
        docs: The list of service level IDs that you want returned.
        type: optional<list<string>>
      max_delivery_days:
        docs: The maximum number of delivery days for this shipment.
        type: optional<integer>
      rate_types: optional<list<RateTypes>>

  Shipment:
    docs: A shipment object
    properties:
      amount:
        docs: The amount that will be collected from a customer. This includes any upcharges or discounts you have added to the price on the PackageX Dashboard.
        type: optional<integer>
      billed_amount:
        docs: The amount that your organization will be billed for this rate.
        type: optional<integer>
      provider:
        type: optional<commons.Provider>
      created_at:
        docs: Time in epoch seconds when this shipment was created.
        type: integer
      updated_at:
        docs: Time in epoch seconds when this shipment was last updated.
        type: integer
      currency: Currency
      estimated_delivery:
        docs: Time in epoch seconds when we estimate the delivery will occur.
        type: optional<integer>
      filters: list<commons.Filters>
      fulfillment_id:
        docs: The ID of the fulfillment that created this shipment.
        type: string
      id:
        docs: The unique ID for the shipment
        type: ShipmentId
      refund_status: optional<RefundStatus>
      status: ShipmentStatus
      lead_time_mins:
        docs: The amount of lead time needed to prepare the shipment for an on-demand courier. This is only applicable for same-day shipments and indicated how much advance notice is required between the shipping provider and sender before a courier will be dispatched.
        type: integer
      metadata:
        docs: Custom key value pairs that the organization is able to add to this shipment
        type: optional<map<string, unknown>>
      options: optional<ShipmentOptions>
      paid:
        docs: If the shipment has been paid for
        type: boolean
      parcels:
        docs: The individual packages that are part of this shipment.
        type: list<fulfillment.Parcel>
      payment_reference:
        docs: A user generated reference for this payment. Will be included in invoices.
        type: optional<string>
      purchased_rate: optional<Rate>
      rates:
        docs: All of the rates that were returned when creating this shipment
        type: list<Rate>
      recipient: commons.Recipient
      sender: commons.Sender
      pickup_at:
        docs: Seconds from epoch when this shipment will be picked up, if pickup is part of the rate's service level
        type: optional<integer>
      organization_id:
        docs: The ID of the organization that owns this shipment
        type: string
      label_url:
        docs: The url for the shipping label
        type: optional<string>
      invoice_id:
        docs: The ID of the invoice for this shipment
        type: string
      kiosk_id:
        docs: This kiosk that was used to generate this shipment.
        type: string
      tracking_number:
        docs: The tracking number for this shipment.
        type: string
      tracking_url:
        docs: The url for the end user to track their shipment
        type: string
      feedback: optional<ShipmentFeedback>
      tracking_updates:
        docs: A list of all tracking updates that occurred for this shipment from oldest to newest
        type: list<TrackingUpdate>
      coordinates: list<double>
      _search: optional<commons.Search>
    examples:
      - name: Example1
        value:
          amount: 1324
          billed_amount: 1023
          provider: $commons.Provider.Example1
          created_at: 1679245915
          updated_at: 1679245933
          currency: usd
          estimated_delivery: 1679591515
          filters: [completed]
          fulfillment_id: efewifb31221
          id: defbei39dkna
          status: out_for_delivery
          lead_time_mins: 13
          paid: true
          parcels: [$fulfillment.Parcel.Example1]
          purchased_rate: $Rate.Example1
          rates: [$Rate.Example1]
          recipient: $commons.Recipient.Example1
          sender: $commons.Sender.Example1
          organization_id: dwndiwqe22en2
          invoice_id: verwdwdwq3j33x2
          kiosk_id: fcewueek9393
          tracking_number: wefewfwecn290ioieqoi1221239
          tracking_url: https://www.ups.com/track?loc=en_US&requester=ST/
          tracking_updates:
            [$TrackingUpdate.Example1, $TrackingUpdate.Example2]
          coordinates: [37.7749, 122.4194]

  ParcelShipment:
    docs: A parcel or package that will be included in a shipment
    properties:
      length:
        docs: The length of the package in inches
        type: optional<integer>
      width:
        docs: The width of the package in inches
        type: optional<integer>
      height:
        docs: The height of the package in inches
        type: optional<integer>
      weight:
        docs: The weight of the package in pounds
        type: optional<integer>
      type: optional<PackageType>
      special_handling:
        docs: Any special handing instructions provided. Not all shipping providers support these
        type: optional<SpecialHandling>
      inventory:
        docs: The inventory packed inside of the parcel
        type: optional<fulfillment.Inventory>
    examples:
      - name: Example1
        value:
          length: 2
          width: 5
          height: 4
          weight: 1
          type: usps_flat_rate_envelope

  TrackingUpdate:
    docs: The record of each tracking update from a shipment
    properties:
      address: address.ParsedAddress
      status: ShipmentStatus
      comment:
        docs: A shipping provider comment
        type: optional<string>
      images:
        docs: Urls of images
        type: list<string>
      message:
        docs: Human readable text explaining the status
        type: string
      event:
        docs: The event that occurred when this event was created. For all events see https://docs.packagex.io/shipments/events
        type: ShipmentEvent
      created_at:
        docs: Time from unix eopch seconds when this tracking update was created
        type: integer
      updated_at:
        docs: The time in epoch seconds when this status was last updated
        type: integer
      location_id:
        docs: The ID of the location of this update, if it is one of your locations.
        type: optional<string>
      layout_id:
        docs: The ID of the layout that this item is on, if it matches one of your locations.
        type: optional<string>
    examples:
      - name: Example1
        value:
          address: $address.ParsedAddress.Example1
          status: in_transit
          message: In Transit
          images: []
          created_at: 1679591515
          updated_at: 1679591623
          event: shipment.tracking_updated
      - name: Example2
        value:
          address: $address.ParsedAddress.Example1
          status: out_for_delivery
          message: Out for Delivery
          images: []
          created_at: 1679591515
          updated_at: 1679591623
          event: shipment.tracking_updated
  
  ShipmentEvent: 
    enum: 
      - value: shipment.rates_generated
        name: rates_generated
        docs: Shipping rates were generated
      - value: shipment.expired
        name: expired
        docs: | 
          The shipment expired. 
          To protect on demand couriers, shipments need to be purchased within 15 minutes
      - value: shipment.purchased
        name: purchased
        docs: When the shipment is purchased successfully
      - value: shipment.tracking_updated
        name: tracking_updated
        docs: The provider has updated the shipment's status
      - value: shipment.canceled
        name: canceled
        docs: The shipment was canceled, usually because the sender requested a refund
      - value: shipment.refunded
        name: refunded
        docs: The shipment was successfully refunded.
      - value: shipment.coordinates_updated
        name: coordinates_updated
        docs: The live location was updated in the shipment, but the status was not changed

  ShipmentFeedback:
    docs: User provided feedback for this shipment
    properties:
      rating: optional<FeedbackRating>
      comment:
        docs: A comment that the user provided about their experience
        type: optional<string>
      updated_at:
        docs: When the feedback was updated in epoch seconds
        type: optional<integer>

  FeedbackRating:
    type: integer

  Currency:
    docs: The currency used for this shipment.
    enum:
      - usd
  
  SpecialHandling: 
    enum: 
      - confidential
      - fragile
      - urgent
      - perishable
      - legal_document
      - oversized
      - dry_ice
      - batteries
      - time_sensitive
      - signature
  
  ShipmentStatus:
    docs: The current status for the shipment. It's the same status as the latest tracking_update just surfaced for convenience. See https://docs.packagex.io/shipments/statuses for more info on statuses.
    enum:
      - rates_generated
      - created
      - address_issue
      - provider_at_pickup
      - contact_provider
      - delayed
      - delivery_attempted
      - delivery_rescheduled
      - delivery_scheduled
      - out_for_delivery
      - package_accepted
      - package_at_waypoint
      - in_transit
      - pickup_available
      - provider_at_dropoff
      - package_damaged
      - delivered
      - return_to_sender
      - package_undeliverable
      - package_lost
      - canceled

  PackageType:
    docs: The courier specific packaging. See https://docs.packagex.io/shipments/predefined-packages for more information
    enum:
      - usps_flat_rate_envelope
      - usps_flat_rate_window_envelope
      - usps_small_flat_rate_envelope
      - usps_flat_rate_padded_envelope
      - usps_flat_rate_legal_envelope
      - usps_small_flat_rate_box
      - usps_medium_flat_rate_box_1
      - usps_medium_flat_rate_box_2
      - usps_large_flat_rate_box_1
      - usps_large_flat_rate_box_2
      - usps_large_flat_rate_box_apo_fpo
